<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Operator - Guestbook</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <style>body{font-family:'Poppins',system-ui, sans-serif}</style>
</head>
<body class="min-h-screen bg-gray-50">
  <div class="container mx-auto p-6">
    <a href="index.html" class="text-sm text-gray-600">‚Üê Kembali</a>
    <div class="mt-4 bg-white rounded-2xl p-6 shadow">
      <h2 class="text-lg font-semibold">Operator Dashboard</h2>
      <div class="mt-4 flex gap-3">
        <input id="search" class="rounded border px-3 py-2 flex-1" placeholder="Cari nama atau ID" />
        <button id="btnAdd" class="px-4 py-2 rounded bg-green-600 text-white">Tambah Tamu</button>
        <button id="btnExport" class="px-4 py-2 rounded border">Export CSV</button>
      </div>

      <div class="mt-4 overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead><tr class="text-gray-600"><th class="px-3 py-2">ID</th><th class="px-3 py-2">Nama</th><th class="px-3 py-2">Kontak</th><th class="px-3 py-2">Status</th><th class="px-3 py-2">Aksi</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <!-- modal add -->
      <div id="modal" class="fixed inset-0 flex items-center justify-center bg-black/40 hidden">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md">
          <h3 class="font-semibold">Tambah Tamu</h3>
          <div class="mt-3 space-y-2">
            <input id="mName" class="w-full rounded border px-3 py-2" placeholder="Nama" />
            <input id="mContact" class="w-full rounded border px-3 py-2" placeholder="Kontak" />
          </div>
          <div class="mt-4 flex justify-end gap-2">
            <button id="closeModal" class="px-4 py-2 rounded border">Batal</button>
            <button id="saveModal" class="px-4 py-2 rounded bg-indigo-600 text-white">Simpan</button>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
const KEY='wedding_guest_v2'; let guests = JSON.parse(localStorage.getItem(KEY)||'[]');
if(!guests.length){ guests = [ {id:'GUEST-001',name:'Siti Nurhaliza',contact:'0812xxxx',checkedIn:false,time:null} ]; localStorage.setItem(KEY, JSON.stringify(guests)); }

function render(){ const tb = document.getElementById('tbody'); tb.innerHTML=''; guests.forEach(g=>{ const tr = document.createElement('tr'); tr.innerHTML = `<td class="px-3 py-2">${g.id}</td><td class="px-3 py-2">${g.name}</td><td class="px-3 py-2">${g.contact||'-'}</td><td class="px-3 py-2">${g.checkedIn? 'Hadir':'Belum'}</td><td class="px-3 py-2"><button data-id="${g.id}" class="toggleBtn px-3 py-1 rounded border">Toggle</button> <button data-id="${g.id}" class="qrBtn px-3 py-1 rounded border">QR</button></td>`; tb.appendChild(tr); }); }
render();

document.addEventListener('click', e=>{
  if(e.target.matches('.toggleBtn')){ const id = e.target.dataset.id; const g = guests.find(x=>x.id===id); if(g){ g.checkedIn = !g.checkedIn; g.time = g.checkedIn? new Date().toLocaleString():null; localStorage.setItem(KEY, JSON.stringify(guests)); render(); }}
  if(e.target.matches('.qrBtn')){ const id = e.target.dataset.id; const modal = document.createElement('div'); modal.className='fixed inset-0 flex items-center justify-center bg-black/40'; const card = document.createElement('div'); card.className='bg-white p-6 rounded-lg'; const canvas = document.createElement('canvas'); card.appendChild(canvas); QRCode.toCanvas(canvas, id, {width:220}, err=>{ if(err) card.append('Gagal'); }); const p = document.createElement('div'); p.className='mt-2 text-sm text-gray-600'; p.textContent = id; card.appendChild(p); const close = document.createElement('button'); close.className='mt-3 px-3 py-1 rounded border'; close.textContent='Tutup'; close.addEventListener('click', ()=>document.body.removeChild(modal)); card.appendChild(close); modal.appendChild(card); document.body.appendChild(modal); }
});

// modal add
const modal = document.getElementById('modal'); document.getElementById('btnAdd').addEventListener('click', ()=> modal.classList.remove('hidden'));
document.getElementById('closeModal').addEventListener('click', ()=> modal.classList.add('hidden'));
document.getElementById('saveModal').addEventListener('click', ()=>{
  const name = document.getElementById('mName').value.trim(); const contact = document.getElementById('mContact').value.trim(); if(!name) return alert('Nama wajib'); const id='GUEST-'+String(Math.floor(Math.random()*90000)+10000); const newG={id,name,contact,checkedIn:false,time:null}; guests.unshift(newG); localStorage.setItem(KEY, JSON.stringify(guests)); render(); modal.classList.add('hidden'); document.getElementById('mName').value=''; document.getElementById('mContact').value='';
});

// export csv
document.getElementById('btnExport').addEventListener('click', ()=>{
  const rows = [['id','name','contact','checkedIn','time']]; guests.forEach(g=>rows.push([g.id,g.name,g.contact,g.checkedIn,g.time])); const csv = rows.map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n'); const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='guests.csv'; a.click(); URL.revokeObjectURL(url);
});

// search
document.getElementById('search').addEventListener('input', e=>{ const q=e.target.value.toLowerCase(); const tb=document.getElementById('tbody'); tb.innerHTML=''; guests.filter(g=> g.id.toLowerCase().includes(q)||g.name.toLowerCase().includes(q)).forEach(g=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td class="px-3 py-2">${g.id}</td><td class="px-3 py-2">${g.name}</td><td class="px-3 py-2">${g.contact||'-'}</td><td class="px-3 py-2">${g.checkedIn? 'Hadir':'Belum'}</td><td class="px-3 py-2"><button data-id="${g.id}" class="toggleBtn px-3 py-1 rounded border">Toggle</button> <button data-id="${g.id}" class="qrBtn px-3 py-1 rounded border">QR</button></td>`; tb.appendChild(tr); }); });

</script>
</body>
</html>